

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Basics: Tic-tac-toe &mdash; Drystal v1.1 documentation</title>
  

  
  

  
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  
    <link rel="top" title="Drystal v1.1 documentation" href="../index.html"/>
        <link rel="up" title="Tutorials" href="../tutorials.html"/>
        <link rel="next" title="Resources" href="../resources.html"/>
        <link rel="prev" title="Tutorials" href="../tutorials.html"/> 

  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/modernizr/2.6.2/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        <a href="../index.html" class="fa fa-home"> Drystal</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
        
            <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../api.html">API Reference</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../api.html#engine">Engine</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#event">Event</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#graphics">Graphics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#font-rendering">Font rendering</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#particle-system">Particle System</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#physics">Physics</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#audio">Audio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#storage">Storage</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#web">Web</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#timer">Timer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../api.html#utils">Utils</a></li>
</ul>
</li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="">Basics: Tic-tac-toe</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../resources.html">Resources</a><ul>
<li class="toctree-l2"><a class="reference internal" href="../resources.html#useful-links">Useful links</a></li>
</ul>
</li>
</ul>

        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Drystal</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
      
    <li>Basics: Tic-tac-toe</li>
      <li class="wy-breadcrumbs-aside">
        
          <a href="../_sources/tutorials/basics.txt" rel="nofollow"> View page source</a>
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            
  <div class="section" id="basics-tic-tac-toe">
<h1>Basics: Tic-tac-toe<a class="headerlink" href="#basics-tic-tac-toe" title="Permalink to this headline">¶</a></h1>
<p>This tutorial will teach you about some basic features (drawing primitives, colors, surface, fonts, mouse events) of
Drystal by creating a <a class="reference external" href="https://en.wikipedia.org/wiki/Tic-tac-toe">Tic-tac-toe</a> game.</p>
<img alt="../_images/basics_final.gif" src="../_images/basics_final.gif" />
<div class="contents local topic" id="contents">
<ul class="simple">
<li><a class="reference internal" href="#getting-our-first-window" id="id1">Getting our first window</a></li>
<li><a class="reference internal" href="#drawing-the-board" id="id2">Drawing the board</a></li>
<li><a class="reference internal" href="#drawing-sprites" id="id3">Drawing sprites</a><ul>
<li><a class="reference internal" href="#loading-the-resources" id="id4">Loading the resources</a></li>
<li><a class="reference internal" href="#let-s-draw" id="id5">Let&#8217;s draw!</a></li>
</ul>
</li>
<li><a class="reference internal" href="#getting-mouse-events" id="id6">Getting mouse events</a></li>
<li><a class="reference internal" href="#is-there-a-winner" id="id7">Is there a winner ?</a></li>
<li><a class="reference internal" href="#gameover-screen" id="id8">Gameover screen</a></li>
<li><a class="reference internal" href="#bonus-highlighting-the-tiles" id="id9">Bonus: Highlighting the tiles</a></li>
<li><a class="reference internal" href="#final-code" id="id10">Final code</a></li>
</ul>
</div>
<div class="section" id="getting-our-first-window">
<h2><a class="toc-backref" href="#id1">Getting our first window</a><a class="headerlink" href="#getting-our-first-window" title="Permalink to this headline">¶</a></h2>
<p>First of all we need to get the Drystal table:</p>
<div class="code highlight-lua"><div class="highlight"><pre><span class="kd">local</span> <span class="n">drystal</span> <span class="o">=</span> <span class="nb">require</span> <span class="s1">&#39;</span><span class="s">drystal&#39;</span>
</pre></div>
</div>
<p>Then, we define <a class="reference internal" href="../api.html#drystal.init" title="drystal.init"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.init()</span></tt></a> which will be called by Drystal when the script will be loaded.</p>
<p>In this function we call <a class="reference internal" href="../api.html#drystal.resize" title="drystal.resize"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.resize()</span></tt></a> with the width and height of our window.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="n">drystal</span> <span class="o">=</span> <span class="nb">require</span> <span class="s1">&#39;</span><span class="s">drystal&#39;</span>
<span class="kd">local</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>Now that we have a window we define <a class="reference internal" href="../api.html#drystal.draw" title="drystal.draw"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw()</span></tt></a> which will be called by Drystal when drawing the window.
This function will contain all the code needed to have beautiful graphics for our game. We start by drawing a black background
and through this tutorial you will see how we can complete this function.</p>
<p>When using Drystal drawing functions you need to set the color you want to use. For this there is <a class="reference internal" href="../api.html#drystal.set_color" title="drystal.set_color"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.set_color()</span></tt></a>, it takes
RGB values (from 0 to 255) or a <a class="reference internal" href="../api.html#drystal.Color" title="drystal.Color"><tt class="xref lua lua-class docutils literal"><span class="pre">Color</span></tt></a>.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Drystal provides a table, <a class="reference internal" href="../api.html#drystal.colors" title="drystal.colors"><tt class="xref lua lua-data docutils literal"><span class="pre">drystal.colors</span></tt></a>, which contains all of the
<a class="reference external" href="http://www.w3.org/TR/css3-color/#svg-color">W3C colors</a>.</p>
</div>
<p>After setting the right color, you just call <a class="reference internal" href="../api.html#drystal.draw_background" title="drystal.draw_background"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw_background()</span></tt></a> and it&#8217;s done.</p>
<div class="code highlight-lua"><div class="highlight"><pre><span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>
<span class="k">end</span>
</pre></div>
</div>
<img alt="../_images/basics_black.png" src="../_images/basics_black.png" />
<p>Congratulation, you managed to get a fully functional window with a beautiful black background with Drystal! Don&#8217;t worry this is just the
beginning of a wonderful adventure!</p>
</div>
<div class="section" id="drawing-the-board">
<h2><a class="toc-backref" href="#id2">Drawing the board</a><a class="headerlink" href="#drawing-the-board" title="Permalink to this headline">¶</a></h2>
<p>Having a black background is nice but we need to show our players where to put X or O. So let&#8217;s draw a simple board with white lines, shall we?</p>
<p>For this we reuse <a class="reference internal" href="../api.html#drystal.set_color" title="drystal.set_color"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.set_color()</span></tt></a> and use <a class="reference internal" href="../api.html#drystal.draw_line" title="drystal.draw_line"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw_line()</span></tt></a> which draws a line between two points.
And we reuse the <tt class="docutils literal"><span class="pre">W</span></tt> and <tt class="docutils literal"><span class="pre">H</span></tt> variables (width and height) to draw lines that fit the window.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_board</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
    <span class="c1">-- horizontal lines</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
    <span class="c1">-- vertical lines</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>

    <span class="n">draw_board</span><span class="p">()</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<img alt="../_images/basics_board.png" src="../_images/basics_board.png" />
</div>
<div class="section" id="drawing-sprites">
<h2><a class="toc-backref" href="#id3">Drawing sprites</a><a class="headerlink" href="#drawing-sprites" title="Permalink to this headline">¶</a></h2>
<p>Now we focus on drawing the noughts and crosses on the board by using <a class="reference external" href="https://en.wikipedia.org/wiki/Sprite_(computer_graphics)">sprites</a>.</p>
<div class="section" id="loading-the-resources">
<h3><a class="toc-backref" href="#id4">Loading the resources</a><a class="headerlink" href="#loading-the-resources" title="Permalink to this headline">¶</a></h3>
<p>First, we use our favorite image manipulation program to get a <a class="reference download internal" href="../_downloads/spritesheet.png"><tt class="xref download docutils literal"><span class="pre">spritesheet</span></tt></a> with our
graphics. Then, we load this spritesheet with <a class="reference internal" href="../api.html#drystal.load_surface" title="drystal.load_surface"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.load_surface()</span></tt></a> which give us a
<a class="reference internal" href="../api.html#drystal.Surface" title="drystal.Surface"><tt class="xref lua lua-class docutils literal"><span class="pre">Surface</span></tt></a> that we can manipulate.</p>
<p>Finally, we define a table containing the location of the sprites and their size. It will be needed later when we will
draw the sprites.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="n">drystal</span> <span class="o">=</span> <span class="nb">require</span> <span class="s1">&#39;</span><span class="s">drystal&#39;</span>

<span class="kd">local</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>

<span class="c1">-- load resources</span>
<span class="kd">local</span> <span class="n">spritesheet</span> <span class="o">=</span> <span class="n">drystal</span><span class="p">.</span><span class="n">load_surface</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">spritesheet.png&#39;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">sprites</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">128</span> <span class="p">},</span> <span class="c1">-- O</span>
    <span class="p">{</span> <span class="n">x</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">128</span> <span class="p">},</span> <span class="c1">-- X</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="let-s-draw">
<h3><a class="toc-backref" href="#id5">Let&#8217;s draw!</a><a class="headerlink" href="#let-s-draw" title="Permalink to this headline">¶</a></h3>
<p>Now that we have our resources we can tell Drystal what to draw at each frame.</p>
<p>First, we keep a state of the game (i.e. where are the marks) and we define a matrix of 9 by 9 where
an empty string represents a free tile, <tt class="docutils literal"><span class="pre">x</span></tt> the player one, <tt class="docutils literal"><span class="pre">o</span></tt> the player two.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="n">board</span> <span class="o">=</span> <span class="p">{</span>
    <span class="p">{</span><span class="s1">&#39;</span><span class="s">o&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;</span><span class="s">o&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">x&#39;</span><span class="p">},</span>
    <span class="p">{</span><span class="s1">&#39;</span><span class="s">x&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
<span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>Second, we tell Drystal from which <a class="reference internal" href="../api.html#drystal.Surface" title="drystal.Surface"><tt class="xref lua lua-class docutils literal"><span class="pre">Surface</span></tt></a> to draw from, we can use the method
<a class="reference internal" href="../api.html#drystal.Surface:draw_from" title="drystal.Surface:draw_from"><tt class="xref lua lua-meth docutils literal"><span class="pre">Surface:draw_from()</span></tt></a> for this:</p>
<div class="code highlight-lua"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_marks</span><span class="p">()</span>
    <span class="n">spritesheet</span><span class="p">:</span><span class="n">draw_from</span><span class="p">()</span>
</pre></div>
</div>
<p>Last, for each tile in the matrix we draw a sprite or nothing according to its content.</p>
<p>Different functions can be used to draw sprites from the current surface. For this game we use
<a class="reference internal" href="../api.html#drystal.draw_sprite_resized" title="drystal.draw_sprite_resized"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw_sprite_resized()</span></tt></a> which allows us to resize a sprite before drawing it. Since,
we divided the window into 9 tiles, the size of one tile is <tt class="docutils literal"><span class="pre">W</span> <span class="pre">/</span> <span class="pre">3</span></tt> and <tt class="docutils literal"><span class="pre">H</span> <span class="pre">/</span> <span class="pre">3</span></tt>.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_marks</span><span class="p">()</span>
    <span class="n">spritesheet</span><span class="p">:</span><span class="n">draw_from</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
            <span class="kd">local</span> <span class="n">mark</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
            <span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">elseif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">o&#39;</span> <span class="k">then</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>

    <span class="n">draw_board</span><span class="p">()</span>
    <span class="n">draw_marks</span><span class="p">()</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<img alt="../_images/basics_sprites.png" src="../_images/basics_sprites.png" />
</div>
</div>
<div class="section" id="getting-mouse-events">
<h2><a class="toc-backref" href="#id6">Getting mouse events</a><a class="headerlink" href="#getting-mouse-events" title="Permalink to this headline">¶</a></h2>
<p>We have a game that currently only display a hardcoded state of a game and I think we can agree on the fact that this
is not really a funny game. We need to let the players interact by clicking on the tile where they want to make a move.</p>
<p>Drystal calls <a class="reference internal" href="../api.html#drystal.mouse_press" title="drystal.mouse_press"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.mouse_press()</span></tt></a> whenever a mouse button is pressed with the coordinate and which button
is pressed. We use this function to call another function that plays a turn according to the current player.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">play</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">j</span>

    <span class="c1">-- is there already a nought or a cross on this tile ?</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>

    <span class="c1">-- set the tile</span>
    <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_player</span>

    <span class="c1">-- switch player</span>
    <span class="k">if</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
        <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">o&#39;</span>
    <span class="k">else</span>
        <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">mouse_press</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="n">drystal</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">left</span> <span class="k">then</span>
        <span class="n">play</span><span class="p">()</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="is-there-a-winner">
<h2><a class="toc-backref" href="#id7">Is there a winner ?</a><a class="headerlink" href="#is-there-a-winner" title="Permalink to this headline">¶</a></h2>
<p>Unfortunately, the game can not stop currently. For each move we need to check if one of the players won the game, this
way we can display a gameover screen and restart the game.</p>
<p>Checking if someone won in a tic-tac-toe game is fairly simple, we check if there is the same mark in a horizontal, vertical
or diagonal line:</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">check_winner</span><span class="p">()</span>
    <span class="c1">-- horizontal lines</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1">-- vertical lines</span>
    <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
        <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">then</span>
            <span class="k">return</span> <span class="kc">true</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="c1">-- diagonal lines</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">end</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
        <span class="k">return</span> <span class="kc">true</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="kc">false</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>There is also the case where no one won, so we check if the board is full:</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">check_board_full</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
            <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="k">then</span>
                <span class="k">return</span> <span class="kc">false</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
    <span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>This ways, each time a player makes a move, we call <tt class="docutils literal"><span class="pre">check_winner()</span></tt> and <tt class="docutils literal"><span class="pre">check_board_full()</span></tt> to know if the game ended:</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">play</span><span class="p">()</span>
    <span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">j</span>

    <span class="c1">-- is there already a nought or a cross on this tile ?</span>
    <span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="k">then</span>
        <span class="k">return</span>
    <span class="k">end</span>

    <span class="c1">-- set the tile</span>
    <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_player</span>

    <span class="k">if</span> <span class="n">check_winner</span><span class="p">()</span> <span class="k">then</span>
        <span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span>
    <span class="k">elseif</span> <span class="n">check_board_full</span><span class="p">()</span> <span class="k">then</span>
        <span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span>
        <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
    <span class="k">else</span>
        <span class="c1">-- switch player</span>
        <span class="k">if</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
            <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">o&#39;</span>
        <span class="k">else</span>
            <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>We also make a function to restart the game when it is finished and a player clicked on the window:</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">restart</span><span class="p">()</span>
    <span class="n">ended</span> <span class="o">=</span> <span class="kc">false</span>
    <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
    <span class="n">board</span> <span class="o">=</span> <span class="p">{</span>
        <span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
        <span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
    <span class="p">}</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">mouse_press</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="n">drystal</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">left</span> <span class="k">then</span>
        <span class="k">if</span> <span class="n">ended</span> <span class="k">then</span>
            <span class="n">restart</span><span class="p">()</span>
        <span class="k">else</span>
            <span class="n">play</span><span class="p">()</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="gameover-screen">
<h2><a class="toc-backref" href="#id8">Gameover screen</a><a class="headerlink" href="#gameover-screen" title="Permalink to this headline">¶</a></h2>
<p>The players would like to know who won the game or if there is a tie, so we need a proper gameover screen.</p>
<p>First, we load two fonts with <a class="reference internal" href="../api.html#drystal.load_font" title="drystal.load_font"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.load_font()</span></tt></a> that will be used to write on the window who won:</p>
<div class="code highlight-lua"><div class="highlight"><pre><span class="c1">-- load resources</span>
<span class="kd">local</span> <span class="n">font</span> <span class="o">=</span> <span class="nb">assert</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">load_font</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">arial.ttf&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="kd">local</span> <span class="n">smallfont</span> <span class="o">=</span> <span class="nb">assert</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">load_font</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">arial.ttf&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
</pre></div>
</div>
<p>Then, we draw a transparent rectangle which fade the window by using <a class="reference internal" href="../api.html#drystal.set_alpha" title="drystal.set_alpha"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.set_alpha()</span></tt></a>
and <a class="reference internal" href="../api.html#drystal.draw_rect" title="drystal.draw_rect"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw_rect()</span></tt></a>. The former modifying the alpha channel which control the transparency
and the latter drawing a rectangle that we use to draw a rectangle the size of the window.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_gameover</span><span class="p">()</span>
    <span class="c1">-- fade the screen</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

    <span class="kd">local</span> <span class="n">text</span>
    <span class="k">if</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Player 1 won the game!&quot;</span>
    <span class="k">elseif</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">o&#39;</span> <span class="k">then</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Player 2 won the game!&quot;</span>
    <span class="k">else</span>
        <span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">It&#39;s a tie!&quot;</span>
    <span class="k">end</span>
    <span class="kd">local</span> <span class="n">_</span><span class="p">,</span> <span class="n">htext</span> <span class="o">=</span> <span class="n">font</span><span class="p">:</span><span class="n">sizeof</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
    <span class="n">font</span><span class="p">:</span><span class="n">draw</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">htext</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">drystal</span><span class="p">.</span><span class="n">aligns</span><span class="p">.</span><span class="n">center</span><span class="p">)</span>

    <span class="n">smallfont</span><span class="p">:</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Click to restart&#39;</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">.7</span><span class="p">,</span> <span class="n">drystal</span><span class="p">.</span><span class="n">aligns</span><span class="p">.</span><span class="n">center</span><span class="p">)</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>Finally, we update <a class="reference internal" href="../api.html#drystal.draw" title="drystal.draw"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.draw()</span></tt></a> so that we call <tt class="docutils literal"><span class="pre">draw_gameover()</span></tt> when <tt class="docutils literal"><span class="pre">ended</span></tt> is <tt class="docutils literal"><span class="pre">true</span></tt>:</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12</pre></div></td><td class="code"><div class="highlight"><pre><span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>

    <span class="n">draw_board</span><span class="p">()</span>
    <span class="n">draw_marks</span><span class="p">()</span>

    <span class="c1">-- draw the winner</span>
    <span class="k">if</span> <span class="n">ended</span> <span class="k">then</span>
        <span class="n">draw_gameover</span><span class="p">()</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<img alt="../_images/basics_gameover.png" src="../_images/basics_gameover.png" />
</div>
<div class="section" id="bonus-highlighting-the-tiles">
<h2><a class="toc-backref" href="#id9">Bonus: Highlighting the tiles</a><a class="headerlink" href="#bonus-highlighting-the-tiles" title="Permalink to this headline">¶</a></h2>
<p>We want the current player to know where the pointer is. For this we define a table <tt class="docutils literal"><span class="pre">highlighted_tile</span></tt> and we update it
with our definition of <a class="reference internal" href="../api.html#drystal.mouse_motion" title="drystal.mouse_motion"><tt class="xref lua lua-func docutils literal"><span class="pre">drystal.mouse_motion()</span></tt></a> which will be called when the mouse is moved by the player.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>1
2
3
4
5
6
7
8</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="n">highlighted_tile</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=-</span><span class="mi">1</span><span class="p">}</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">mouse_motion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">highlighted_tile</span> <span class="o">=</span> <span class="p">{</span>
        <span class="n">i</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
        <span class="n">j</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
    <span class="p">}</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
<p>Since we have the information about the mouse position we can draw the sprite (nought or cross) but with a bit of transparency
to show the difference between the pointer and a real cross or nought.</p>
<div class="code highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_marks</span><span class="p">()</span>
    <span class="n">spritesheet</span><span class="p">:</span><span class="n">draw_from</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
        <span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
            <span class="kd">local</span> <span class="n">mark</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
            <span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
            <span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
            <span class="k">if</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">elseif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">o&#39;</span> <span class="k">then</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">i</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">j</span> <span class="k">then</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
                <span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="ow">and</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span>
                <span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="n">sprite</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
            <span class="k">end</span>
        <span class="k">end</span>
    <span class="k">end</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
    <span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>

    <span class="n">draw_board</span><span class="p">()</span>
    <span class="n">draw_marks</span><span class="p">()</span>

    <span class="c1">-- draw the winner</span>
    <span class="k">if</span> <span class="n">ended</span> <span class="k">then</span>
        <span class="n">draw_gameover</span><span class="p">()</span>
    <span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
</div>
<div class="section" id="final-code">
<h2><a class="toc-backref" href="#id10">Final code</a><a class="headerlink" href="#final-code" title="Permalink to this headline">¶</a></h2>
<p>Here is the complete code of this tutorial, don&#8217;t hesitate to improve it with your ideas, and if you want to know more
go to the next tutorial where we will show you how to do a space invader!</p>
<div class="highlight-lua"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre>  1
  2
  3
  4
  5
  6
  7
  8
  9
 10
 11
 12
 13
 14
 15
 16
 17
 18
 19
 20
 21
 22
 23
 24
 25
 26
 27
 28
 29
 30
 31
 32
 33
 34
 35
 36
 37
 38
 39
 40
 41
 42
 43
 44
 45
 46
 47
 48
 49
 50
 51
 52
 53
 54
 55
 56
 57
 58
 59
 60
 61
 62
 63
 64
 65
 66
 67
 68
 69
 70
 71
 72
 73
 74
 75
 76
 77
 78
 79
 80
 81
 82
 83
 84
 85
 86
 87
 88
 89
 90
 91
 92
 93
 94
 95
 96
 97
 98
 99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181</pre></div></td><td class="code"><div class="highlight"><pre><span class="kd">local</span> <span class="n">drystal</span> <span class="o">=</span> <span class="nb">require</span> <span class="s1">&#39;</span><span class="s">drystal&#39;</span>

<span class="kd">local</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">=</span> <span class="mi">400</span><span class="p">,</span> <span class="mi">400</span>

<span class="c1">-- load resources</span>
<span class="kd">local</span> <span class="n">font</span> <span class="o">=</span> <span class="nb">assert</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">load_font</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">arial.ttf&#39;</span><span class="p">,</span> <span class="mi">40</span><span class="p">))</span>
<span class="kd">local</span> <span class="n">smallfont</span> <span class="o">=</span> <span class="nb">assert</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">load_font</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">arial.ttf&#39;</span><span class="p">,</span> <span class="mi">24</span><span class="p">))</span>
<span class="kd">local</span> <span class="n">spritesheet</span> <span class="o">=</span> <span class="n">drystal</span><span class="p">.</span><span class="n">load_surface</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">spritesheet.png&#39;</span><span class="p">)</span>
<span class="kd">local</span> <span class="n">sprites</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span> <span class="n">x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">128</span> <span class="p">},</span> <span class="c1">-- O</span>
	<span class="p">{</span> <span class="n">x</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">128</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">128</span> <span class="p">},</span> <span class="c1">-- X</span>
<span class="p">}</span>

<span class="c1">-- game info</span>
<span class="kd">local</span> <span class="n">ended</span> <span class="o">=</span> <span class="kc">false</span>
<span class="kd">local</span> <span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
<span class="kd">local</span> <span class="n">board</span> <span class="o">=</span> <span class="p">{</span>
	<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
	<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
	<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
<span class="p">}</span>
<span class="kd">local</span> <span class="n">highlighted_tile</span> <span class="o">=</span> <span class="p">{</span><span class="n">i</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">j</span><span class="o">=-</span><span class="mi">1</span><span class="p">}</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">init</span><span class="p">()</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_board</span><span class="p">()</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
	<span class="c1">-- horizontal lines</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
	<span class="c1">-- vertical lines</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_line</span><span class="p">(</span><span class="n">W</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_marks</span><span class="p">()</span>
	<span class="n">spritesheet</span><span class="p">:</span><span class="n">draw_from</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
		<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
			<span class="kd">local</span> <span class="n">mark</span> <span class="o">=</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span>
			<span class="kd">local</span> <span class="n">x</span> <span class="o">=</span> <span class="n">W</span> <span class="o">*</span> <span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
			<span class="kd">local</span> <span class="n">y</span> <span class="o">=</span> <span class="n">H</span> <span class="o">*</span> <span class="p">(</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">3</span>
			<span class="k">if</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
			<span class="k">elseif</span> <span class="n">mark</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">o&#39;</span> <span class="k">then</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
			<span class="k">elseif</span> <span class="n">i</span> <span class="o">==</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">i</span> <span class="ow">and</span> <span class="n">j</span> <span class="o">==</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">j</span> <span class="k">then</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
				<span class="kd">local</span> <span class="n">sprite</span> <span class="o">=</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="ow">and</span> <span class="mi">2</span> <span class="ow">or</span> <span class="mi">1</span>
				<span class="n">drystal</span><span class="p">.</span><span class="n">draw_sprite_resized</span><span class="p">(</span><span class="n">sprites</span><span class="p">[</span><span class="n">sprite</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">3</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">3</span><span class="p">)</span>
			<span class="k">end</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">draw_gameover</span><span class="p">()</span>
	<span class="c1">-- fade the screen</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">150</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">W</span><span class="p">,</span> <span class="n">H</span><span class="p">)</span>

	<span class="kd">local</span> <span class="n">text</span>
	<span class="k">if</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
		<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Player 1 won the game!&quot;</span>
	<span class="k">elseif</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">o&#39;</span> <span class="k">then</span>
		<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">Player 2 won the game!&quot;</span>
	<span class="k">else</span>
		<span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="s">It&#39;s a tie!&quot;</span>
	<span class="k">end</span>
	<span class="kd">local</span> <span class="n">_</span><span class="p">,</span> <span class="n">htext</span> <span class="o">=</span> <span class="n">font</span><span class="p">:</span><span class="n">sizeof</span><span class="p">(</span><span class="n">text</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">white</span><span class="p">)</span>
	<span class="n">font</span><span class="p">:</span><span class="n">draw</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">H</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="n">htext</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">drystal</span><span class="p">.</span><span class="n">aligns</span><span class="p">.</span><span class="n">center</span><span class="p">)</span>

	<span class="n">smallfont</span><span class="p">:</span><span class="n">draw</span><span class="p">(</span><span class="s1">&#39;</span><span class="s">Click to restart&#39;</span><span class="p">,</span> <span class="n">W</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">H</span> <span class="o">*</span> <span class="mf">.7</span><span class="p">,</span> <span class="n">drystal</span><span class="p">.</span><span class="n">aligns</span><span class="p">.</span><span class="n">center</span><span class="p">)</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">draw</span><span class="p">()</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_alpha</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">set_color</span><span class="p">(</span><span class="n">drystal</span><span class="p">.</span><span class="n">colors</span><span class="p">.</span><span class="n">black</span><span class="p">)</span>
	<span class="n">drystal</span><span class="p">.</span><span class="n">draw_background</span><span class="p">()</span>

	<span class="n">draw_board</span><span class="p">()</span>
	<span class="n">draw_marks</span><span class="p">()</span>

	<span class="c1">-- draw the winner</span>
	<span class="k">if</span> <span class="n">ended</span> <span class="k">then</span>
		<span class="n">draw_gameover</span><span class="p">()</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">check_winner</span><span class="p">()</span>
	<span class="c1">-- horizontal lines</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
		<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
			<span class="k">return</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">end</span>
	<span class="c1">-- vertical lines</span>
	<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
		<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="k">then</span>
			<span class="k">return</span> <span class="kc">true</span>
		<span class="k">end</span>
	<span class="k">end</span>
	<span class="c1">-- diagonal lines</span>
	<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
		<span class="k">return</span> <span class="kc">true</span>
	<span class="k">end</span>
	<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">3</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="ow">and</span> <span class="n">board</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="n">board</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="k">then</span>
		<span class="k">return</span> <span class="kc">true</span>
	<span class="k">end</span>
	<span class="k">return</span> <span class="kc">false</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">check_board_full</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
		<span class="k">for</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span> <span class="k">do</span>
			<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="k">then</span>
				<span class="k">return</span> <span class="kc">false</span>
			<span class="k">end</span>
		<span class="k">end</span>
	<span class="k">end</span>
	<span class="k">return</span> <span class="kc">true</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">play</span><span class="p">()</span>
	<span class="kd">local</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span> <span class="o">=</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">i</span><span class="p">,</span> <span class="n">highlighted_tile</span><span class="p">.</span><span class="n">j</span>

	<span class="c1">-- is there already a nought or a cross on this tile ?</span>
	<span class="k">if</span> <span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">~=</span> <span class="s1">&#39;</span><span class="s">&#39;</span> <span class="k">then</span>
		<span class="k">return</span>
	<span class="k">end</span>

	<span class="c1">-- set the tile</span>
	<span class="n">board</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">current_player</span>

	<span class="k">if</span> <span class="n">check_winner</span><span class="p">()</span> <span class="k">then</span>
		<span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span>
	<span class="k">elseif</span> <span class="n">check_board_full</span><span class="p">()</span> <span class="k">then</span>
		<span class="n">ended</span> <span class="o">=</span> <span class="kc">true</span>
		<span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">&#39;</span>
	<span class="k">else</span>
		<span class="c1">-- switch player</span>
		<span class="k">if</span> <span class="n">current_player</span> <span class="o">==</span> <span class="s1">&#39;</span><span class="s">x&#39;</span> <span class="k">then</span>
			<span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">o&#39;</span>
		<span class="k">else</span>
			<span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>

<span class="kd">local</span> <span class="k">function</span> <span class="nf">restart</span><span class="p">()</span>
	<span class="n">ended</span> <span class="o">=</span> <span class="kc">false</span>
	<span class="n">current_player</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="s">x&#39;</span>
	<span class="n">board</span> <span class="o">=</span> <span class="p">{</span>
		<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
		<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
		<span class="p">{</span><span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">,</span> <span class="s1">&#39;</span><span class="s">&#39;</span><span class="p">},</span>
	<span class="p">}</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">mouse_motion</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
	<span class="n">highlighted_tile</span> <span class="o">=</span> <span class="p">{</span>
		<span class="n">i</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">y</span> <span class="o">/</span> <span class="n">W</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
		<span class="n">j</span> <span class="o">=</span> <span class="nb">math.ceil</span><span class="p">(</span><span class="n">x</span> <span class="o">/</span> <span class="n">H</span> <span class="o">*</span> <span class="mi">3</span><span class="p">),</span>
	<span class="p">}</span>
<span class="k">end</span>

<span class="k">function</span> <span class="nc">drystal</span><span class="p">.</span><span class="nf">mouse_press</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">button</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">button</span> <span class="o">==</span> <span class="n">drystal</span><span class="p">.</span><span class="n">buttons</span><span class="p">.</span><span class="n">left</span> <span class="k">then</span>
		<span class="k">if</span> <span class="n">ended</span> <span class="k">then</span>
			<span class="n">restart</span><span class="p">()</span>
		<span class="k">else</span>
			<span class="n">play</span><span class="p">()</span>
		<span class="k">end</span>
	<span class="k">end</span>
<span class="k">end</span>
</pre></div>
</td></tr></table></div>
</div>
</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../resources.html" class="btn btn-neutral float-right" title="Resources"/>Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../tutorials.html" class="btn btn-neutral" title="Tutorials"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2014, Jérémy Anger.
    </p>
  </div>

  <a href="https://github.com/snide/sphinx_rtd_theme">Sphinx theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>
</footer>
        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'v1.1',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>